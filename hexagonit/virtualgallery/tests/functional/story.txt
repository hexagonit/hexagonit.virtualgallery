User story
==========

A scripted walk-through of basic features of hexagonit.virtualgallery.

Prepare
-------

We'll start by importing what we need and adding a Folder so we can later
add images to it.

    >>> from StringIO import StringIO
    >>> foo = portal.invokeFactory('Folder', 'gallery')
    >>> import transaction; transaction.commit()

Now, let's login so we can later use the `Add new ...` drop-down menu and start
adding an Image.

    Go to login screen.
    >>> browser.open(portal.absolute_url() + '/login')

    Fill in your credentials.
    >>> browser.getControl(name='__ac_name').value = TEST_USER_NAME
    >>> browser.getControl(name='__ac_password').value = TEST_USER_PASSWORD

    Click Login button.
    >>> browser.getControl(name='submit').click()

    Are we logged in?
    >>> "You are now logged in" in browser.contents
    True


Add an Image
---------------

Let's now add an Image, to our Folder.

    Click on the add link to open the form for adding an Image.
    >>> browser.open(portal.gallery.absolute_url())
    >>> browser.getLink(id='image').click()

    Fill in fields.
    >>> browser.getControl(name='title').value = "Image"
    >>> browser.getControl(name='image_file').add_file(StringIO(PNG_IMAGE), 'image/png', 'image.png')

    Click submit to create the Image.
    >>> browser.getControl(name='form.button.save').click()

    Was our Image really created?
    >>> 'Changes saved' in browser.contents
    True
    >>> hasattr(portal.gallery, 'image')
    True


Set Folder's display view to 'virtualgallery'
---------------------------------------------

    First, make sure that the settings action is not available before
    activating the gallery view.
    >>> browser.open(portal.gallery.absolute_url())
    >>> 'Virtual gallery settings' in browser.contents
    False

    Verify that we have the link to display view.
    >>> browser.getLink(id='virtualgallery').url.endswith("selectViewTemplate?templateId=virtualgallery")
    True

    Click to set display view.
    >>> browser.getLink(id='virtualgallery').click()
    >>> 'View changed' in browser.contents
    True

    Check that gallery JavaScripts and divs are present in HTML
    >>> '++resource++hexagonit.virtualgallery/swfobject.js' in browser.contents
    True
    >>> 'dataURL:"http://nohost/plone/gallery/@@virtualgallery.json"' in browser.contents
    True
    >>> '<div id="virtualgallery-wrapper">' in browser.contents
    True
    >>> '<div id="altContent">' in browser.contents
    True

    Check that the settings action is now visible.
    >>> 'Virtual gallery settings' in browser.contents
    True


Configure the gallery to use a particular image scale
-----------------------------------------------------

Navigate to the virtual gallery settings form.

    >>> browser.getLink('Virtual gallery settings').click()
    >>> browser.url.endswith('@@virtualgallery-settings')
    True

    Make sure we have a selection of scales to choose from.
    >>> image_scale = browser.getControl('Image scale')
    >>> image_scale.options
    ['__original__', 'icon', 'large', 'listing', 'mini', 'preview', 'thumb', 'tile']

    Choose a scale
    >>> image_scale.value = ['thumb']
    >>> browser.getControl('Save changes').click()

    Assert that the choice was persisted correctly.

    >>> from hexagonit.virtualgallery.interfaces import IVirtualGallerySettings
    >>> IVirtualGallerySettings(portal.gallery).image_scale
    'thumb'
